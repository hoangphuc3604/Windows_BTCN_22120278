<Page
    x:Class="Windows_22120278.Views.DrawingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Windows_22120278.Views"
    xmlns:vm="using:Windows_22120278.ViewModels"
    xmlns:models="using:Windows_22120278_Data.models">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Toolbar Row -->
        <Border Grid.Row="0" 
                Background="{ThemeResource ControlFillColorDefaultBrush}"
                Padding="12,8"
                BorderThickness="0,0,0,1"
                BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                MaxHeight="120">
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"
                         ZoomMode="Disabled">
                <StackPanel Orientation="Horizontal" MinHeight="80">
                    <!-- Shapes Group -->
                    <Border BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" 
                           BorderThickness="0,0,1,0"
                           Padding="12,8"
                           Margin="0,0,12,0"
                           CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="Shapes" 
                                      FontSize="11"
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,4" />
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <Button Command="{Binding SelectToolCommand}"
                                        CommandParameter="{x:Bind models:ShapeType.Line, Mode=OneTime}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <!-- Keep icon content consistent with others: 32x32 visual box -->
                                    <Viewbox Width="32" Height="32" Stretch="Uniform">
                                        <Grid Width="32" Height="32">
                                            <Path Stroke="{ThemeResource TextFillColorPrimaryBrush}"
                                                  StrokeThickness="2"
                                                  Data="M 0,32 L 32,0"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center" />
                                        </Grid>
                                    </Viewbox>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Line" />
                                    </ToolTipService.ToolTip>
                                </Button>
                                <Button Command="{Binding SelectToolCommand}"
                                        CommandParameter="{x:Bind models:ShapeType.Rectangle, Mode=OneTime}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <FontIcon Glyph="&#xE739;" FontFamily="Segoe Fluent Icons" FontSize="20"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Rectangle" />
                                    </ToolTipService.ToolTip>
                                </Button>
                                <Button Command="{Binding SelectToolCommand}"
                                        CommandParameter="{x:Bind models:ShapeType.Ellipse, Mode=OneTime}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <FontIcon Glyph="&#xEA3A;" FontFamily="Segoe Fluent Icons" FontSize="20"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Ellipse" />
                                    </ToolTipService.ToolTip>
                                </Button>
                                <Button Command="{Binding SelectToolCommand}"
                                        CommandParameter="{x:Bind models:ShapeType.Polygon, Mode=OneTime}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <PathIcon Data="M 10,2 L 19,9 L 15,19 L 5,19 L 1,9 Z" 
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Polygon" />
                                    </ToolTipService.ToolTip>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Color Group -->
                    <Border BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" 
                           BorderThickness="0,0,1,0"
                           Padding="12,8"
                           Margin="0,0,12,0"
                           CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="Color" 
                                      FontSize="11"
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,4" />
                            <Button x:Name="ColorPickerButton"
                                    Width="48"
                                    Height="48"
                                    HorizontalAlignment="Center"
                                    CornerRadius="4"
                                    Padding="8">
                                <Button.Flyout>
                                    <Flyout Placement="Bottom">
                                        <ColorPicker x:Name="ColorPickerControl"
                                                    ColorChanged="ColorPicker_ColorChanged"
                                                    IsAlphaEnabled="False"
                                                    IsColorSpectrumVisible="True"
                                                    IsColorChannelTextInputVisible="True"
                                                    IsHexInputVisible="True"
                                                    IsMoreButtonVisible="True"
                                                    Width="300" />
                                    </Flyout>
                                </Button.Flyout>
                                <Border x:Name="ColorPreviewBorder"
                                       Background="Black"
                                       BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                       BorderThickness="1.5"
                                       CornerRadius="4"
                                       Width="32"
                                       Height="32"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- Stroke Group -->
                    <Border BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" 
                           BorderThickness="0,0,1,0"
                           Padding="12,8"
                           Margin="0,0,12,0"
                           CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="Stroke" 
                                      FontSize="11"
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,4" />
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Slider Minimum="1" 
                                       Maximum="20" 
                                       Value="{Binding CurrentStrokeSize, Mode=TwoWay}"
                                       Width="80"
                                       VerticalAlignment="Center" />
                                <TextBlock Text="{Binding CurrentStrokeSize, Mode=OneWay}"
                                          Width="25"
                                          TextAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="4,0,0,0"
                                          FontSize="11" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Actions Group -->
                    <Border Padding="12,8"
                           Margin="0,0,12,0"
                           CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="Actions" 
                                      FontSize="11"
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,4" />
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <Button Command="{Binding SaveDrawingCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <FontIcon Glyph="&#xE74E;" FontFamily="Segoe Fluent Icons" FontSize="20"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Save" />
                                    </ToolTipService.ToolTip>
                                </Button>
                                <Button Command="{Binding ClearCanvasCommand}"
                                        Style="{StaticResource DefaultButtonStyle}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <FontIcon Glyph="&#xE894;" FontFamily="Segoe Fluent Icons" FontSize="20"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Clear" />
                                    </ToolTipService.ToolTip>
                                </Button>
                                <Button Click="BackButton_Click"
                                        Style="{StaticResource DefaultButtonStyle}"
                                        Width="48"
                                        Height="48"
                                        CornerRadius="4"
                                        Padding="8">
                                    <FontIcon Glyph="&#xE72B;" FontFamily="Segoe Fluent Icons" FontSize="20"/>
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Back" />
                                    </ToolTipService.ToolTip>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>
            </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Drawing Area Row -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Templates Panel -->
            <StackPanel Grid.Column="0"
                       Width="200"
                       Background="{ThemeResource ControlFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                       BorderThickness="0,0,1,0"
                       Padding="12">
                <TextBlock Text="Templates"
                          FontSize="14"
                          FontWeight="Bold"
                          Margin="0,0,0,8" />
                <Button Command="{Binding SaveAsTemplateCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        HorizontalAlignment="Stretch"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;" FontFamily="Segoe Fluent Icons" FontSize="16"/>
                        <TextBlock Text="Save as Template" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <GridView x:Name="TemplatesGridView"
                         ItemsSource="{Binding Templates}"
                         SelectionMode="Single"
                         IsItemClickEnabled="True"
                         MaxHeight="400"
                         SelectionChanged="TemplatesGridView_SelectionChanged">
                    <GridView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                   BorderThickness="1"
                                   Padding="8"
                                   Margin="4"
                                   CornerRadius="4">
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}"
                                              FontSize="12"
                                              FontWeight="SemiBold"
                                              TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding Type}"
                                              FontSize="10"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                              Margin="0,4,0,0" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>
        </StackPanel>

        <ScrollViewer Grid.Column="1">
                <Canvas x:Name="DrawingCanvas" 
                        Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                        PointerPressed="DrawingCanvas_PointerPressed"
                        PointerMoved="DrawingCanvas_PointerMoved"
                        PointerReleased="DrawingCanvas_PointerReleased"
                        PointerCanceled="DrawingCanvas_PointerReleased"
                        DoubleTapped="DrawingCanvas_DoubleTapped" />
        </ScrollViewer>

            <!-- Properties Panel -->
            <StackPanel x:Name="PropertiesPanel"
                       Grid.Column="2"
                       Width="250"
                       Background="{ThemeResource ControlFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                       BorderThickness="1,0,0,0"
                       Padding="16"
                       Spacing="12"
                       Visibility="Collapsed">
                <!-- Header with Close button -->
                <Grid Margin="0,0,0,16">
                    <TextBlock Text="Properties"
                              FontSize="14"
                              FontWeight="Bold"
                              VerticalAlignment="Center" />
                    <Button x:Name="ClosePropertiesButton"
                           Width="32"
                           Height="32"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"
                           Padding="0"
                           CornerRadius="4"
                           Click="ClosePropertiesButton_Click"
                           Style="{StaticResource DefaultButtonStyle}"
                           ToolTipService.ToolTip="Close">
                        <FontIcon Glyph="&#xE8BB;" FontFamily="Segoe Fluent Icons" FontSize="16"/>
                    </Button>
                </Grid>

                <!-- Color -->
                <TextBlock Text="Color"
                          FontSize="11"
                          FontWeight="SemiBold"
                          Margin="0,0,0,4" />
                <Button x:Name="ShapeColorPickerButton"
                        Width="200"
                        Height="48"
                        CornerRadius="4"
                        Margin="0,0,0,0"
                        Padding="8">
                    <Button.Flyout>
                        <Flyout Placement="Left">
                            <ColorPicker x:Name="ShapeColorPickerControl"
                                        ColorChanged="ShapeColorPicker_ColorChanged"
                                        IsAlphaEnabled="False"
                                        IsColorSpectrumVisible="True"
                                        IsColorChannelTextInputVisible="True"
                                        IsHexInputVisible="True"
                                        IsMoreButtonVisible="True"
                                        Width="300" />
                        </Flyout>
                    </Button.Flyout>
                    <Border x:Name="ShapeColorPreviewBorder"
                           Background="Black"
                           BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                           BorderThickness="1.5"
                           CornerRadius="4"
                           Width="32"
                           Height="32"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
                </Button>

                <!-- Width -->
                <TextBlock Text="Width"
                          FontSize="11"
                          FontWeight="SemiBold"
                          Margin="0,0,0,8" />
                <StackPanel Orientation="Horizontal" Margin="0,0,0,0" Spacing="8">
                    <Slider Minimum="1"
                           Maximum="1000"
                           Value="{Binding SelectedShape.Width, Mode=TwoWay}"
                           Width="150"
                           VerticalAlignment="Center" />
                    <TextBlock Text="{Binding SelectedShape.Width, Mode=OneWay}"
                              Width="40"
                              TextAlignment="Center"
                              VerticalAlignment="Center"
                              FontSize="11" />
            </StackPanel>

                <!-- Height -->
                <TextBlock Text="Height"
                          FontSize="11"
                          FontWeight="SemiBold"
                          Margin="0,0,0,8" />
                <StackPanel Orientation="Horizontal" Margin="0,0,0,0" Spacing="8">
                    <Slider Minimum="1"
                           Maximum="1000"
                           Value="{Binding SelectedShape.Height, Mode=TwoWay}"
                           Width="150"
                           VerticalAlignment="Center" />
                    <TextBlock Text="{Binding SelectedShape.Height, Mode=OneWay}"
                              Width="40"
                              TextAlignment="Center"
                              VerticalAlignment="Center"
                              FontSize="11" />
                </StackPanel>

                <!-- Stroke Thickness -->
                <TextBlock Text="Stroke Thickness"
                          FontSize="11"
                          FontWeight="SemiBold"
                          Margin="0,0,0,8" />
                <StackPanel Orientation="Horizontal" Margin="0,0,0,0" Spacing="8">
                    <Slider Minimum="1"
                           Maximum="20"
                           Value="{Binding SelectedShape.StrokeThickness, Mode=TwoWay}"
                           Width="150"
                           VerticalAlignment="Center" />
                    <TextBlock Text="{Binding SelectedShape.StrokeThickness, Mode=OneWay}"
                              Width="40"
                              TextAlignment="Center"
                              VerticalAlignment="Center"
                              FontSize="11" />
        </StackPanel>

                <!-- Delete Button -->
                <Button Command="{Binding DeleteSelectedShapeCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        HorizontalAlignment="Stretch"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <FontIcon Glyph="&#xE74D;" FontFamily="Segoe Fluent Icons" FontSize="16"/>
                        <TextBlock Text="Delete Shape" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
